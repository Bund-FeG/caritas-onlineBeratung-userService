openapi: 3.0.1
info:
  title: will be replaced
  description: This information will be replaced by the SpringFox config information
  version: 0.0.1
servers:
  - url: /
paths:
  /useradmin:
    get:
      tags:
        - root-controller
      summary: 'Returns the hal root entry point. [Authorization: Role: user-admin]'
      operationId: getRoot
      responses:
        200:
          description: OK - successfull operation
          content:
            application/hal+json:
              schema:
                $ref: '#/components/schemas/RootDTO'
      security:
        - Bearer: [ ]
  /useradmin/report:
    get:
      tags:
        - admin-user-controller
      summary: 'Returns an generated report containing data integration violations. [Authorization:
      Role: user-admin]'
      operationId: generateViolationReport
      responses:
        200:
          description: OK - successfull operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ViolationDTO'
        401:
          description: UNAUTHORIZED - no/invalid role/authorization
        500:
          description: INTERNAL SERVER ERROR - server encountered unexpected condition
      security:
        - Bearer: [ ]
  /useradmin/session:
    get:
      tags:
        - admin-user-controller
      summary: 'Returns the list of agencies by search query parameter. [Authorization: Role:
      user-admin]'
      operationId: getSessions
      parameters:
        - name: filter
          in: query
          description: 'The filter parameters to search for. If no filter is set all sessions are
          being returned. If more than one filter is set the first given filter is used only.'
          schema:
            type: object
            properties:
              agency:
                type: integer
              asker:
                type: string
              consultant:
                type: string
              consultingType:
                type: integer
        - name: page
          in: query
          description: Number of page where to start in the query (1 = first page)
          required: true
          schema:
            type: integer
        - name: perPage
          in: query
          description: Number of items which are being returned per page
          required: true
          schema:
            type: integer
      responses:
        200:
          description: OK - successfull operation
          content:
            'application/hal+json':
              schema:
                $ref: '#/components/schemas/SessionAdminResultDTO'
        400:
          description: BAD REQUEST - invalid/incomplete request or body object
        401:
          description: UNAUTHORIZED - no/invalid role/authorization
        500:
          description: INTERNAL SERVER ERROR - server encountered unexpected condition
      security:
        - Bearer: [ ]

  /useradmin/consultant/{consultantId}/agencies:
    get:
      tags:
        - admin-user-controller
      summary: 'Returns the list of consultant-agency connections for a given consultant Id. [Authorization: Role:
      user-admin]'
      operationId: getConsultantAgency
      parameters:
        - name: consultantId
          in: path
          description: Consultant Id
          required: true
          schema:
            type: string
      responses:
        200:
          description: OK - successfull operation
          content:
            'application/hal+json':
              schema:
                $ref: '#/components/schemas/ConsultantAgencyAdminResultDTO'
        400:
          description: BAD REQUEST - invalid/incomplete request or body object
        401:
          description: UNAUTHORIZED - no/invalid role/authorization
        500:
          description: INTERNAL SERVER ERROR - server encountered unexpected condition
      security:
        - Bearer: [ ]

  /useradmin/consultant/{consultantId}/agency:
    post:
      tags:
        - admin-consultant-agency-controller
      summary: 'Create a consultant-agency relation [Authorization: Role: user-admin]'
      operationId: createConsultantAgency
      parameters:
        - name: consultantId
          in: path
          description: Consultant Id
          required: true
          schema:
            type: string
      requestBody:
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/CreateConsultantAgencyDTO'
        required: true
      responses:
        200:
          description: OK - consultant-agency relation was created successfully
        400:
          description: BAD REQUEST - invalid/incomplete request
        401:
          description: UNAUTHORIZED - no/invalid role/authorization
        500:
          description: INTERNAL SERVER ERROR - server encountered unexpected condition
      security:
        - Bearer: [ ]

  /useradmin/consultant/{consultantId}/agency/{agencyId}:
    delete:
      tags:
        - admin-consultant-agency-controller
      summary: 'Delete a consultant-agency relation [Authorization: Role: user-admin]'
      operationId: deleteConsultantAgency
      parameters:
        - name: consultantId
          in: path
          description: Consultant Id
          required: true
          schema:
            type: string
        - name: agencyId
          in: path
          description: Agency Id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        200:
          description: OK - consultant-agency relation was deleted successfully
        400:
          description: BAD REQUEST - invalid/incomplete request
        401:
          description: UNAUTHORIZED - no/invalid role/authorization
        500:
          description: INTERNAL SERVER ERROR - server encountered unexpected condition
      security:
        - Bearer: [ ]

components:
  schemas:
    RootDTO:
      type: object
      required:
        - _links
      properties:
        _links:
          $ref: '#/components/schemas/RootLinks'

    RootLinks:
      type: object
      required:
        - self
      properties:
        self:
          $ref: '#/components/schemas/HalLink'
        sessions:
          $ref: '#/components/schemas/HalLink'
        consultantagencies:
          $ref: '#/components/schemas/HalLink'

    HalLink:
      type: object
      required:
        - href
      properties:
        href:
          type: string
        method:
          type: string
          enum: [ GET, POST, DELETE, PUT ]
        templated:
          type: boolean

    SessionAdminResultDTO:
      type: object
      properties:
        _embedded:
          type: array
          items:
            $ref: '#/components/schemas/SessionAdminDTO'
        _links:
          $ref: '#/components/schemas/SessionAdminResultLinks'

    SessionAdminDTO:
      type: object
      properties:
        userId:
          type: string
          example: "1da238c6-cd46-4162-80f1-bff74eafe77f"
        consultantId:
          type: string
          example: "1da238c6-cd46-4162-80f1-bff74eafe77f"
        username:
          type: string
          example: "enc.OBSXEZTPOJWWC3TDMUWWC43LMVZC2NZS"
        email:
          type: string
          example: "email@beratungcaritas.de"
        consultingType:
          type: integer
          example: 1
        postcode:
          type: string
          example: "12345"
        agencyId:
          type: integer
          example: 1
        isTeamSession:
          type: boolean
        messageDate:
          type: string
        createDate:
          type: string
        updateDate:
          type: string

    SessionAdminResultLinks:
      type: object
      required:
        - self
      properties:
        self:
          $ref: '#/components/schemas/HalLink'
        next:
          $ref: '#/components/schemas/HalLink'
        previous:
          $ref: '#/components/schemas/HalLink'

    ConsultantAgencyAdminResultDTO:
      type: object
      properties:
        _embedded:
          type: array
          items:
            $ref: '#/components/schemas/ConsultantAgencyAdminDTO'
        _links:
          $ref: '#/components/schemas/ConsultantAgencyAdminResultLinks'

    ConsultantAgencyAdminResultLinks:
      type: object
      required:
        - self
      properties:
        self:
          $ref: '#/components/schemas/HalLink'

    ConsultantAgencyAdminDTO:
      type: object
      properties:
        consultantId:
          type: string
          example: aadc0ecf-c048-4bfc-857d-8c9b2e425500
        agencyId:
          type: integer
          format: int64
          example: 15
        createDate:
          type: string
          format: date
          example: 2019-10-23
        editDate:
          type: string
          format: date
          example: 2019-10-23

    CreateConsultantAgencyDTO:
       type: object
       properties:
         agencyId:
           type: integer
           format: int64
           example: 15
         role:
           type: string

    ViolationDTO:
      type: object
      properties:
        violationType:
          type: string
          enum:
            - 'CONSULTANT'
            - 'ASKER'
        identifier:
          type: string
        reason:
          type: string
        additionalInformation:
          type: array
          items:
            $ref: '#/components/schemas/AdditionalInformationDTO'

    AdditionalInformationDTO:
      type: object
      properties:
        name:
          type: string
        value:
          type: string

  securitySchemes:
    Bearer:
      type: apiKey
      name: Authorization
      in: header
