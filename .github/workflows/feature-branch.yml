name: Feature Branch

on:
  push:
    branches-ignore:
      - 'master'
      - 'develop'

jobs:
  test:
    name: Build and run unit tests
    runs-on: ubuntu-latest
    steps:

    - name: Checkout
      uses: actions/checkout@v2

    - name: Setup JVM
      uses: actions/setup-java@v1
      with:
        java-version: 11.0.10
        java-package: jdk
        architecture: x64

    - name: Caching maven dependencies
      uses: actions/cache@v1
      env:
        cache-name: cache-maven-dependencies
      with:
        path: ~/.m2/repository
        key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/pom.xml') }}

    - name: Maven generate sources
      run: mvn generate-sources

    - name: Push Admin API to documentation
      uses: andstor/copycat-action@v3
      with:
        personal_token: ${{ secrets.GITHUB_TOKEN }}
        src_path: readme.md
        dst_path: docs/backend/admin/userservice
        dst_owner: CaritasDeutschland
        dst_repo_name: documentation
        dst_branch: develop
        commit_message: 'docs: updated user service admin api description'

    - name: Maven Package
      run: mvn -B -Pprod clean package -Dskip.unit-tests=true -Dskip.integration-tests=true

    - name: Maven Verify
      run: mvn -B -Pprod clean verify
